<% layout("/layouts/boilerplate") %>

<body>
    <h1><%= listing.title %> <br>by <%= listing.owner.username %></h1>
    <ul>
        <li><img src="<%= listing.image %>" alt=""></li>
        <li><%= listing.description %></li>
        <li> &#8377;<%= listing.price.toLocaleString("en-in") %></li>
        <li><%= listing.country %></li>
        <li><%= listing.location %></li>
    </ul>
    <% if (currUser && currUser._id.equals(listing.owner._id)){ %>
    <a class="btn btn-primary" href="/listings/<%= listing._id %>/edit">Edit</a>
    <form action="/listings/<%= listing._id %>?_method=DELETE" method="post" >
        <button class="btn btn-danger">Delete Listing</button>
    </form>
    <% } %>
    <% if (currUser){ %>
    <a class="btn btn-warning" href="/listings/<%= listing._id %>/review">Review</a>
    <% } %>

    <div class="reviews">
        <h1>All Reviews</h1>
        <ul>
        <% for (let review of listing.reviews){ %>
            <li>
                <h4><%= review.rating %></h4>
                <h5><%= review.author.username %></h5>
                <p><%= review.comment %></p>
                <% if (currUser && currUser._id.equals(review.author._id)){ %>
                <form method="post" action="/listings/<%= listing._id %>/review/<%= review._id %>?_method=DELETE" >
                    <button>Delete</button>
                </form>
                <% } %>
            </li>
        <% } %>
        </ul>
    </div>

</body>
